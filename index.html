<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>스택 퍼즐</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <style>
    body { background-color: #f8f9fa; text-align: center; padding-top: 50px; }
    #grid { display: flex; justify-content: center; gap: 8px; margin-top: 20px; }
    .column {
      width: 60px;
      height: 240px;
      background: #e9ecef;
      display: flex;
      flex-direction: column-reverse;
      justify-content: start;
      padding: 4px;
      border-radius: 4px;
    }
    .tile {
      width: 100%;
      height: 40px;
      background-color: #ffffff;
      margin-bottom: 4px;
      font-weight: bold;
      line-height: 40px;
      border-radius: 4px;
      box-shadow: 0 0 3px rgba(0,0,0,0.1);
    }
    #next {
      font-size: 24px;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <h1 class="mb-3">🔢 스택 정렬 퍼즐</h1>
  <p class="text-muted">같은 숫자 3개가 쌓이면 사라져요!</p>
  <div id="next">다음 블록: <span id="nextNum"></span></div>
  <div id="grid" class="mt-3"></div>
  <p id="status" class="mt-4 fw-bold"></p>

  <script>
    const cols = 5;
    const colHeight = 6;
    const gridEl = document.getElementById("grid");
    const nextEl = document.getElementById("nextNum");
    const statusEl = document.getElementById("status");

    let nextNumber = 1 + Math.floor(Math.random() * 3);
    const stacks = Array.from({ length: cols }, () => []);

    function renderGrid() {
      gridEl.innerHTML = "";
      for (let i = 0; i < cols; i++) {
        const colEl = document.createElement("div");
        colEl.className = "column";
        colEl.dataset.index = i;
        colEl.addEventListener("click", () => placeTile(i));
        stacks[i].forEach(n => {
          const tile = document.createElement("div");
          tile.className = "tile";
          tile.textContent = n;
          colEl.appendChild(tile);
        });
        gridEl.appendChild(colEl);
      }
    }

    function updateNext() {
      nextNumber = 1 + Math.floor(Math.random() * 3);
      nextEl.textContent = nextNumber;
    }

    function placeTile(index) {
      if (stacks[index].length >= colHeight) {
        statusEl.textContent = "❌ 게임 오버 - 너무 많이 쌓였어요!";
        return;
      }
      stacks[index].push(nextNumber);
      checkClear(index);
      updateNext();
      renderGrid();
    }

    function checkClear(colIndex) {
      const stack = stacks[colIndex];
      if (stack.length >= 3) {
        const top3 = stack.slice(-3);
        if (top3[0] === top3[1] && top3[1] === top3[2]) {
          stack.splice(-3, 3);
          statusEl.textContent = "✅ 블록 3개 제거!";
        } else {
          statusEl.textContent = "";
        }
      }
    }

    renderGrid();
    updateNext();
  </script>
</body>
</html>
